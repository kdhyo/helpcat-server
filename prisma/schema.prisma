generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  id                 Int          @id @default(autoincrement())
  email              String?      @unique
  emailvalidated     Boolean?     @default(false)
  validateEmailToken String?      @unique
  password           String
  userName           String
  nickName           String?      @unique
  gender             String
  phone              String
  address            String
  birh               String
  ratingAvg          Int?
  ratingCount        Int          @default(0)
  createdAt          DateTime     @default(now())
  fromTouser         message[]    @relation("fromTouser")
  toTouser           message[]    @relation("toTouser")
  rating             rating[]
  ansUser            service[]    @relation("ansUser")
  reqUser            service[]    @relation("reqUser")
  useronroom         UserOnRoom[]
}

model rating {
  id        Int      @id @default(autoincrement())
  userId    Int
  rating    Int
  review    String
  createdAt DateTime @default(now())
  user      user     @relation(fields: [userId], references: [id])

  @@index([userId], name: "userId")
}

model room {
  id         Int          @id @default(autoincrement())
  createdAt  DateTime     @default(now())
  message    message[]
  useronroom UserOnRoom[]
}

model service {
  id        Int      @id @default(autoincrement())
  reqUserId Int
  ansUserId Int?
  title     String
  contents  String
  address   String
  price     Int
  progress  Boolean? @default(false)
  createdAt DateTime @default(now())
  startAt   DateTime @default(now())
  endAt     DateTime @default(now())
  ansUser   user?    @relation("ansUser", fields: [ansUserId], references: [id])
  reqUser   user     @relation("reqUser", fields: [reqUserId], references: [id])

  @@index([ansUserId], name: "ansUserId")
  @@index([reqUserId], name: "reqUserId")
}

model message {
  id            Int      @id @default(autoincrement())
  text          String
  from          Int
  to            Int
  room          Int
  createdAt     DateTime @default(now())
  fromTouser    user     @relation("fromTouser", fields: [from], references: [id])
  messageToroom room     @relation(fields: [room], references: [id])
  toTouser      user     @relation("toTouser", fields: [to], references: [id])

  @@index([from], name: "from")
  @@index([room], name: "room")
  @@index([to], name: "to")
}

model UserOnRoom {
  id     Int  @id @default(autoincrement())
  roomId Int
  userId Int
  room   room @relation(fields: [roomId], references: [id])
  user   user @relation(fields: [userId], references: [id])

  @@index([roomId], name: "roomId")
  @@index([userId], name: "userId")
}
